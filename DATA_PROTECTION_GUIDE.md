# 🛡️ دليل حماية البيانات وضمان عدم ضياعها

## 🚨 تحذير مهم
عند رفع التطبيق على منصات سحابية مثل Netlify أو Vercel، قد تضيع البيانات عند إعادة تشغيل الخادم. هذا الدليل يشرح كيفية حماية بياناتك.

## 📋 آليات الحماية المتاحة

### 1. النسخ الاحتياطي التلقائي
- ✅ يتم إنشاء نسخة احتياطية تلقائياً كل 6 ساعات
- ✅ يتم حفظ النسخ في مجلد `server/backups/`
- ✅ تتضمن جميع البيانات (مستثمرين، مصاريف، إيرادات، إلخ)

### 2. النسخ الاحتياطي اليدوي
```javascript
// إنشاء نسخة احتي��طية فورية
POST /api/backup/create
```

### 3. تصدير البيانات للتحميل
```javascript
// تحميل البيانات كملف JSON
GET /api/export
```

### 4. استيراد واستعادة البيانات
```javascript
// استعادة من نسخة احتياطية
POST /api/backup/restore
```

## 🔧 كيفية حماية البيانات عند الرفع

### الطريقة الأولى: استخدام قاعدة بيانات خارجية
```bash
# 1. استخدم قاعدة بيانات سحابية مثل:
# - Supabase (PostgreSQL)
# - PlanetScale (MySQL)
# - MongoDB Atlas
# - Neon (PostgreSQL)
```

### الطريقة الثانية: النسخ الاحتياطي الدوري
1. **قبل الرفع**: قم بتصدير البيانات
2. **بعد الرفع**: استورد البيانات
3. **جدولة**: قم بتحميل نسخة يومياً

### الطريقة الثالثة: Persistent Storage
```bash
# إذا كنت تستخدم Docker أو VPS
# احفظ قاعدة البيانات في volume منفصل
```

## 📱 خطوات عملية لحماية البيانات

### 1. قبل الرفع
```bash
# تصدير البيانات الحالية
curl -H "Authorization: Bearer YOUR_TOKEN" \
     -o backup.json \
     http://localhost:8080/api/export
```

### 2. بعد الرفع
```bash
# رفع البيانات المحفوظة
curl -X POST \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d @backup.json \
     https://your-app.netlify.app/api/import
```

### 3. المراقبة المستمرة
- قم بتحميل نسخة احتياطية يومياً
- اختبر استعادة البيانات دورياً
- احتفظ بنسخ متعددة في أماكن مختلفة

## ⚠️ مشاكل شائعة وحلولها

### المشكلة: البيانات تختفي بعد إعادة التشغيل
**الحل:**
1. استخدم قاعدة بيانات سحابية
2. أو قم بتحميل البيانات قبل إعادة التشغيل
3. واستوردها بعد التشغيل

### المشكلة: فشل في إنشاء نسخة احتياطية
**الحل:**
```javascript
// تحقق من الصلاحيات
if (user.role !== 'Admin') {
  return 'ليس لديك صلاحية';
}

// تحقق من مساحة التخزين
const stats = fs.statSync('server/investment.db');
console.log('Database size:', stats.size);
```

### المشكلة: استعادة البيانات تفشل
**الحل:**
1. تحقق من صيغة ملف النسخة الاحت��اطية
2. تأكد من أن الملف غير تالف
3. تحقق من صلاحيات الكتابة

## 🎯 التوصيات

### للاستخدام المحلي
- ✅ SQLite كافية تماماً
- ✅ النسخ الاحتياطي التلقائي يحمي البيانات
- ✅ تحميل نسخة أسبوعية للأمان

### للاستخدام السحابي
- 🔄 انتقل لقاعدة بيانات سحابية
- 🔄 أو استخدم جدولة للنسخ الاحتياطي
- 🔄 اختبر الاستعادة دورياً

### للاستخدام الإنتاجي
- 🚀 قاعدة بيانات سحابية (Supabase/PostgreSQL)
- 🚀 نسخ احتياطي متعدد المواقع
- 🚀 مراقبة وتنبيهات
- 🚀 خطة استرداد موثقة

## 📞 الدعم
إذا واجهت مشاكل في حفظ البيانات:
1. تحقق من الـ logs
2. جرب إنشاء نسخة احتياطية يدوياً
3. احفظ البيانات خارجياً قبل أي تعديلات

---
**تم إنشاء هذا الدليل لضمان عدم ضياع بياناتك الثمينة!** 🛡️
