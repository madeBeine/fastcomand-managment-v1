# إصلاح تناسق الحسابات عبر جميع الصفحات

## المشاكل التي تم حلها:

### 1. **الرصيد المتاح للتوزيع غير متطابق**
**المشكلة**: صفحة المستثمرين كانت تحسب الرصيد المتاح بجمع `expectedEffectiveProfit` لكل مستثمر بدلاً من استخدام القيمة الصحيحة من dashboard.

**الحل**: 
- إضافة استدعاء `/dashboard` API في صفحة المستثمرين
- استخدام `dashboardStats.availableBalance` مباشرة
- الآن كلا الصفحتين تعرضان نفس القيمة

### 2. **إجمالي الأرباح يظهر 0**
**المشكلة**: صفحة المستثمرين كانت تحسب إجمالي الأرباح من مجموع أرباح المستثمرين الفردية (التي قد تكون 0) بدلاً من أرباح المشروع الإجمالية.

**الحل**:
- استخدام `dashboardStats.totalProfit` بدلاً من مجموع أرباح المستثمرين
- الآن يعرض نفس القيمة الصحيحة الموجودة في Dashboard

### 3. **إجمالي السحوبات**
**الحل**: استخدام `dashboardStats.totalWithdrawals` لضمان التطابق مع Dashboard

## الحسابات المُصححة:

### في صفحة المستثمرين (Investors.tsx):
```typescript
// استخدام بيانات dashboard للحسابات الدقيقة على مستوى المشروع
const totalProfit = dashboardStats?.totalProfit || 0;
const totalWithdrawn = dashboardStats?.totalWithdrawals || 0;
const availableBalance = dashboardStats?.availableBalance || 0;
```

### في Dashboard.tsx:
```typescript
// نفس المصدر للبيانات
stats.totalProfit       // إجمالي أرباح المشروع
stats.totalWithdrawals  // إجمالي السحوبات
stats.availableBalance  // الرصيد المتاح للتوزيع
```

## تدفق الحسابات الصحيح:

1. **إجمالي الربح** = إجمالي الإيرادات - إجمالي المصاريف
2. **نصيب المستثمرين** = إجمالي الربح × نسبة المستثمرين (85%)
3. **الرصيد المتاح للتوزيع** = نصيب المستثمرين - إجمالي السحوبات
4. **الربح المتوقع للمستثمر** = الرصيد المتاح × النسبة الفعلية للمستثمر ÷ 100
5. **رصيد المستثمر** = إجمالي أرباح المستثمر - سحوبات المستثمر

## النتيجة:
✅ **جميع الصفحات الآن تعرض نفس القيم**
✅ **الحسابات متناسقة ومترابطة**
✅ **البيانات تأتي من مصدر واحد موثوق (dashboard stats)**
✅ **لا توجد تناقضات بين الصفحات المختلفة**
